#!/usr/bin/env ruby

require 'pkgforge'
require 'mercenary'

FILE_NAME = '.pkgforge'

Mercenary.program(:pkgforge) do |p|
  p.version PkgForge::VERSION
  p.description 'DSL engine for building Arch packages'
  p.syntax 'pkgforge [options]'

  # rubocop:disable Metrics/LineLength
  p.option :directory, '-d DIR', '--directory DIR', 'Change to directory before loading'
  # rubocop:enable Metrics/LineLength

  p.action do |_, options|
    options[:directory] ||= '.'
    Dir.chdir(options[:directory]) do
      raise("No #{FILE_NAME} file") unless File.exist? FILE_NAME
      PkgForge.load_from_file(FILE_NAME).build!
    end
  end
end
